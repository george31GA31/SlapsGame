<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Match Setup</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        body { background: #000; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; font-family: sans-serif; }
        h1 { font-size: 3rem; font-style: italic; margin-bottom: 10px; }
        h2 { color: #888; margin-bottom: 40px; }
        .btn-play { padding: 20px 60px; font-size: 1.5rem; background: #333; color: #777; border: none; border-radius: 50px; cursor: not-allowed; transition: 0.3s; }
        .btn-play.active { background: #00ccff; color: white; cursor: pointer; box-shadow: 0 0 20px #00ccff; }
    </style>
</head>
<body>

    <h1 id="round-name">TOURNAMENT MATCH</h1>
    <h2 id="opponent-name">VS OPPONENT</h2>
    
    <button id="play-btn" class="btn-play" onclick="enterGame()">CONNECTING...</button>
    <div id="status" style="margin-top:20px; color:#666;">Initializing...</div>

    <script>
        const role = localStorage.getItem('isf_role'); 
        const matchId = localStorage.getItem('isf_code');
        const opponent = localStorage.getItem('isf_tourney_opponent');
        
        let peer = null;

        window.onload = function() {
            document.getElementById('opponent-name').innerText = `VS ${opponent || 'OPPONENT'}`;
            startNetworking();
        };

        function startNetworking() {
            const status = document.getElementById('status');
            const btn = document.getElementById('play-btn');

            if (role === 'host') {
                status.innerText = "Creating Room... Waiting for Opponent";
                peer = new Peer(matchId);
                peer.on('connection', (c) => {
                    status.innerText = "OPPONENT FOUND!";
                    status.style.color = "#00ff00";
                    btn.innerText = "START MATCH";
                    btn.classList.add('active');
                });
            } else {
                status.innerText = "Searching for Host...";
                peer = new Peer();
                peer.on('open', () => {
                    const conn = peer.connect(matchId);
                    conn.on('open', () => {
                        status.innerText = "CONNECTED TO HOST!";
                        status.style.color = "#00ff00";
                        btn.innerText = "START MATCH";
                        btn.classList.add('active');
                    });
                });
            }
        }

        function enterGame() {
            if(peer) peer.destroy();
            // Redirect to the Game Engine
            window.location.href = 'friend-tournament-game.html';
        }
    </script>
</body>
</html>
